name: Generate Files for Java Repository
inputs:
  repository:
    description: "Name of the repository to be created"
    required: true
  application:
    description: "Name of the application"
    required: true
  version:
    description: "Version of the application"
    required: false
    default: "1.0.0"

runs:
  using: composite
  steps:

  - name: Generate Pom
    shell: bash
    run: |
      cat > pom.xml <<'EOF'
      <project xmlns="http://maven.apache.org/POM/4.0.0"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
      
        <modelVersion>4.0.0</modelVersion>
      
        <groupId>com.giustech</groupId>
        <artifactId>${{ inputs.repository }}</artifactId>
        <packaging>jar</packaging>
        <version>${{ inputs.version }}</version>
      
        <properties>
          <protobuf.version>3.23.4</protobuf.version>
          <grpc.version>1.57.2</grpc.version>
        </properties>
      
        <dependencies>
          <!-- Protobuf -->
          <dependency>
            <groupId>com.google.protobuf</groupId>
            <artifactId>protobuf-java</artifactId>
            <version>${protobuf.version}</version>
          </dependency>
      
          <!-- gRPC Dependencies -->
          <dependency>
            <groupId>io.grpc</groupId>
            <artifactId>grpc-netty-shaded</artifactId>
            <version>${grpc.version}</version>
          </dependency>
          <dependency>
            <groupId>io.grpc</groupId>
            <artifactId>grpc-protobuf</artifactId>
            <version>${grpc.version}</version>
          </dependency>
          <dependency>
            <groupId>io.grpc</groupId>
            <artifactId>grpc-stub</artifactId>
            <version>${grpc.version}</version>
          </dependency>
      
          <!-- Para resolver erros de javax.annotation -->
          <dependency>
            <groupId>javax.annotation</groupId>
            <artifactId>javax.annotation-api</artifactId>
            <version>1.3.2</version>
          </dependency>
      
          <!-- Google Guava (usado internamente pelo gRPC) -->
          <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
            <version>32.1.2-jre</version>
          </dependency>
      
          <!-- JUnit para testes -->
          <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13.2</version>
            <scope>test</scope>
          </dependency>
      
      
      <!-- https://mvnrepository.com/artifact/build.buf.protoc-gen-validate/pgv-java-stub -->
          <dependency>
              <groupId>build.buf.protoc-gen-validate</groupId>
              <artifactId>pgv-java-stub</artifactId>
              <version>1.2.1</version>
          </dependency>
                 
        </dependencies>
      
        <build>
          <extensions>
            <extension>
              <groupId>kr.motd.maven</groupId>
              <artifactId>os-maven-plugin</artifactId>
              <version>1.7.0</version>
            </extension>
          </extensions>
      
          <plugins>
            <!-- Plugin do Protobuf -->
            <plugin>
              <groupId>org.xolstice.maven.plugins</groupId>
              <artifactId>protobuf-maven-plugin</artifactId>
              <version>0.6.1</version>
              <configuration>
                <protocArtifact>com.google.protobuf:protoc:${protobuf.version}:exe:${os.detected.classifier}</protocArtifact>
                <pluginId>grpc-java</pluginId>
                <pluginArtifact>io.grpc:protoc-gen-grpc-java:${grpc.version}:exe:${os.detected.classifier}</pluginArtifact>
              </configuration>
              <executions>
                <execution>
                  <goals>
                    <goal>compile</goal>
                    <goal>compile-custom</goal>
                  </goals>
                </execution>
              </executions>
            </plugin>
      
            <!-- Plugin do Maven Compiler -->
            <plugin>
              <groupId>org.apache.maven.plugins</groupId>
              <artifactId>maven-compiler-plugin</artifactId>
              <version>3.8.1</version>
              <configuration>
                <source>11</source>
                <target>11</target>
              </configuration>
            </plugin>
          </plugins>
        </build>
      
        <distributionManagement>
          <repository>
            <id>github</id>
            <url>https://maven.pkg.github.com/soustify/data-gateway-buffer-java</url>
          </repository>
        </distributionManagement>
      
      </project>
      EOF
      

  - name: Create README File
    shell: bash
    run: |
      cat > README.md <<'EOF'
      # ${{ inputs.application }} - Protobuf Connector
  
      Este repositÃ³rio contÃ©m as classes Java geradas (stubs) a partir das definiÃ§Ãµes Protobuf (`.proto`) da **[Sua AplicaÃ§Ã£o Principal]**.
  
      Esta biblioteca atua como um conector oficial, garantindo que serviÃ§os consumidores utilizem os contratos de dados e clientes gRPC corretos e atualizados.
  
      ---
  
      ## ðŸ“¦ InstalaÃ§Ã£o
  
      Configure o seu gerenciador de dependÃªncias conforme abaixo.
  
      ### ðŸ˜ Gradle (build.gradle)
  
      Adicione o repositÃ³rio e a dependÃªncia no seu arquivo `build.gradle`:
  
      ```groovy
      repositories {
          mavenCentral()
          // Exemplo para GitHub Packages ou Nexus Privado
          maven {
              url = uri("https://maven.pkg.github.com/[SEU_USUARIO]/[SEU_REPOSITORIO]")
              credentials {
                  username = System.getenv("GITHUB_ACTOR") ?: "SEU_USUARIO"
                  password = System.getenv("GITHUB_TOKEN") ?: "SEU_TOKEN"
              }
          }
      }
  
      dependencies {
          // Conector da AplicaÃ§Ã£o
          implementation 'com.giustech:${{ inputs.repository }}:${{ inputs.version }}'
  
          // DependÃªncias transitivas do gRPC (caso necessÃ¡rio)
          implementation 'io.grpc:grpc-protobuf:1.58.0'
          implementation 'io.grpc:grpc-stub:1.58.0'
      }
      ```
      EOF


  - name: Create folders
    shell: bash
    run: |
      mkdir -p .github/worfklows
      mkdir -p src/main/java

